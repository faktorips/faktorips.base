<?xml version="1.0" encoding="UTF-8"?>
<project name="org.eclipse.core.resources" default="main" basedir="..">
<!-- THIS BUILDER IS NEEDED FOR LOCAL DEVELOPMENT ONLY -->
	<property name="bootclasspath" value=""/>
	<property name="plugin" value="org.eclipse.core.resources"/>
	<property name="temp.folder" value="${basedir}/temp.folder"/>
	<property name="plugin.destination" value="${basedir}"/>
	<property name="build.result.folder" value="${basedir}/ant_tasks"/>
	<property name="eclipseDir" value="/usr/lib/eclipse-3.4-test/" />
	
	<target name="main" depends="clean, test">
	</target>

	<target name="init" depends="properties">
		
		
		<path id="path">
			<dirset dir="${eclipseDir}">
				<include name="org.eclipse.core.resources/bin"/>
				<include name="org.eclipse.core.runtime/bin"/>
				<include name="org.eclipse.equinox.common/bin"/>
				<include name="org.eclipse.core.jobs/bin"/>
				<include name="org.eclipse.osgi/bin"/>
				<include name="org.eclipse.ant.core/bin"/>
			</dirset>
			
			<fileset dir="${eclipseDir}">
				<include name="plugins/org.eclipse.core.resources*.jar"/>
				<include name="plugins/org.eclipse.core.runtime*.jar"/>
				<include name="plugins/org.eclipse.equinox.common*.jar"/>
				<include name="plugins/org.eclipse.core.jobs*.jar"/>
				<include name="plugins/org.eclipse.osgi*.jar"/>
				<include name="plugins/org.eclipse.ant.core*.jar"/>
				<include name="plugins/org.eclipse.jdt.core*.jar"/>
				<include name="plugins/org.junit*/*.jar"/>
			</fileset>
			
			<!-- dependency to org.faktorips.devtools.core -->
			<fileset dir="../org.faktorips.devtools.core/" >
				<patternset>
		    		<include name="lib/*.jar" /> 
		    		<include name="build/results/*.jar" />
				</patternset>
			</fileset>

			<!-- eclipse libraries, dependency by org.faktorips.devtools.core  -->
			<fileset dir="${eclipseDir}">
				<patternset>
					<include name="plugins/org.eclipse.jface*.jar" />
					<include name="plugins/org.eclipse.text*.jar" />
					<include name="plugins/org.eclipse.jdt*.jar" />
					<include name="plugins/org.eclipse.emf*codegen*.jar" />
					<include name="plugins/org.eclipse.core*.jar" />
					<include name="plugins/org.eclipse.osgi*.jar" />
					<include name="plugins/org.eclipse.swt*.jar" />
					<include name="plugins/org.eclipse.ui*.jar" />
					<include name="plugins/org.eclipse.search*.jar" />
					<include name="plugins/org.eclipse.team.*.jar"/>
					<include name="plugins/org.eclipse.compare*.jar"/>
					<include name="plugins/org.eclipse.debug.core*.jar" />
					<include name="plugins/org.eclipse.debug.ui*.jar" />
					<include name="plugins/org.eclipse.equinox*.jar" />
					<include name="plugins/com.ibm.icu*.jar" />
				</patternset>
			</fileset>

			<pathelement location="${temp.folder}/ant_tasks/ant-tasks.jar.bin/"/>
		</path>
			
			
	</target>

	<target name="properties" if="eclipse.running">
		<property name="build.compiler" value="org.eclipse.jdt.core.JDTCompilerAdapter"/>
	</target>


	
	<target name="ant_tasks/ant-tasks.jar" depends="init" unless="ant_tasks/ant-tasks.jar">

		<property name="destdir" value="${temp.folder}/ant_tasks/ant-tasks.jar.bin"/>
		<delete dir="${temp.folder}/ant_tasks/ant-tasks.jar.bin"/>
		<mkdir dir="${temp.folder}/ant_tasks/ant-tasks.jar.bin"/>
		<!-- compile the source code -->
		<javac destdir="${temp.folder}/ant_tasks/ant-tasks.jar.bin" failonerror="true" verbose="false" debug="off">
			<bootclasspath path="${bootclasspath}"/>
			<classpath refid="path" />
			<src path="${basedir}/src/"/>
			<src path="${basedir}/test/" />
		</javac>

		<!-- copy necessary resources -->
		<copy todir="${temp.folder}/ant_tasks/ant-tasks.jar.bin">
			<fileset dir="src/" excludes="**/*.java"/>
		</copy>
		<mkdir dir="${build.result.folder}"/>
		<jar jarfile="${build.result.folder}/ant-tasks.jar" basedir="${temp.folder}/ant_tasks/ant-tasks.jar.bin"/>

	</target>
	
	<target name="test" depends="ant_tasks/ant-tasks.jar">
		<junit fork="yes" haltonerror="yes" haltonfailure="yes" printsummary="withOutAndErr" timeout="10000"  showoutput="yes">
    		<formatter type="xml" usefile="true"/>
    		<classpath refid="path"/>
    		
    		<!-- put result logfiles into given logdir (passed by cruisecontrol-config.xml in project org.faktorips.eclipsetest -->
			<batchtest filtertrace="off"  todir="${basedir}/scripts/"> 
				<fileset dir="${temp.folder}/ant_tasks/ant-tasks.jar.bin">
					<patternset>
						<exclude name="**/*Abstract*" />
					    <include name="**/*Test.class"/>
					</patternset>
				</fileset>
			</batchtest>
		</junit>
	</target>

	<target name="clean" depends="init">
		<delete file="${build.result.folder}/ant-tasks.jar"/>
		<delete dir="${temp.folder}/ant_tasks/ant-tasks.bin"/>
		<delete dir="${temp.folder}"/>
	</target>
</project>