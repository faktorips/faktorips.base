:jbake-title: 21.12
:jbake-type: section
:jbake-status: published
:images-folder: {images}21_12/

== Version 21.12.0

=== New Features and Improvements

==== Schemas for IPS XML Files (https://jira.faktorzehn.de/browse/FIPS-7445[FIPS-7445])
Faktor-IPS uses XML to persist all IPS objects in the workspace. As those files are written and read exclusively by Faktor-IPS a validation of their content against an XML schema was not necessary. 
As more and more developers want to do small changes to some IPS objects outside of Faktor-IPS, for example with other IDEs or text editors, you can now activate the setting "validateIpsSchema" 
in the .ipsproject configuration file to write a schema reference in every file and validate against that schema on reading and building those files. This setting can also be activated during the migration to Faktor-IPS 21.12.

==== New Maven Mojo features (https://jira.faktorzehn.de/browse/FIPS-7572[FIPS-7572], https://jira.faktorzehn.de/browse/FIPS-8014[FIPS-8014], https://jira.faktorzehn.de/browse/FIPS-7796[FIPS-7796], https://jira.faktorzehn.de/browse/FIPS-8026[FIPS-8026])
The Maven plugin has been expanded with the <buildIpsOnly> option which is set to `true` by default. +
With this parameter the "faktorips-build" only generates the source code, which is then compiled by the "maven-compile" plugin.

In addition, the build mojo now is able to do incremental builds by omitting the `clean` phase. Therefore the working directory is no longer automatically deleted and re-imported.

The logging of the "faktorips-build" was enhanced with the platform debug tracing facility from Eclipse and can be activated with the Maven option `-X`. If for some reason the standard trace settings are not suitable, 
a separate tracing options file can be specified with the parameter `<debugLogOptions>`. Please refer toe: https://wiki.eclipse.org/FAQ_How_do_I_use_the_platform_debug_tracing_facility[FAQ How do I use the platform debug tracing facility]

==== Enhancement of Ant tasks (https://jira.faktorzehn.de/browse/FIPS-8014[FIPS-8014])
The Ant task _FullBuildTask_ has been renamed to _BuildTask_ and two options `ipsOnly` and `fullBuild` have been added. +
The _ipsOnly_ option determines what builders to use. Either only the Faktor-Ips Builder, or all of the configured project builders. +
The _fullBuild_ option controls whether the build is started as a full or incremental build.

The tasks _MavenProjectImportTask_ and _ProjectImportTask_ no longer throw errors if the projects already exist.

==== Jakarta Persistence 2.2 (https://jira.faktorzehn.de/browse/FIPS-7741[FIPS-7741])
Following Oracle's abandonment of Java EE the open source project Jakarta EE was founded. Due to naming rights for "Java" remaining with Oracle in a first step all artifacts were renamed to "Jakarta". 
Because many projects, including for example Spring, switched their dependencies to these renamed artifacts, Faktor-IPS now offers "Jakarta Persistence 2.2" as an option for the persistence provider to be used when persisting Faktor-IPS policy objects in a database. 
The generated annotations are identical to those of the "Generic JPA 2.1" persistence provider; only the dependencies created when creating a Maven project with the Faktor-IPS archetype or adding the IPS nature to an existing Maven project are changed to

[source, xml]
----
<dependency> 
    <groupId>jakarta.persistence</groupId> 
    <artifactId>jakarta.persistence-api</artifactId> 
    <version>2.2.3</version> 
</dependency>
----

With one of the following releases Faktor-IPS will support Jakarta Persistence 3, which is part of Jakarta EE 9 and changes the annotations' namespace from "javax.persistence" to "jakarta.persistence".

==== New Annotation @IpsGenerated (https://jira.faktorzehn.de/browse/FIPS-8109[FIPS-8109])
Many developers use tools for the automated evaluation of code quality. Those tools should check their handwritten code, but not the code generated by Faktor-IPS. Many tools can be configured via comments or annotations. 
Faktor-IPS now provides the annotation org.faktorips.runtime.annotation.IpsGenerated that can be automatically added to all generated methods through the setting +
`<Property name="additionalAnnotations" value="org.faktorips.runtime.annotation.IpsGenerated"/>` +
to keep for example SonarQube/JaCoCo from analysing those methods.

==== Java 17 (https://jira.faktorzehn.de/browse/FIPS-7865[FIPS-7865])
Faktor-IPS 21.12 is tested to run with Java 17 as well as Java 11.

==== Migration (https://jira.faktorzehn.de/browse/FIPS-8143[FIPS-8143])
Upon migration to Faktor-IPS 21.12 the setting "validateIpsSchema" can be activated for the migrated projects, writing XML schema references in all IPS files.

==== Deprecation of loggingFrameworkConnectors (https://jira.faktorzehn.de/browse/FIPS-8120[FIPS-8120])
We marked the extension point loggingFrameworkConnector and the associated interface IIpsLoggingFrameworkConnector as deprecated since we no longer use it in any builder.

==== Navigate to Templates (https://jira.faktorzehn.de/browse/FIPS-7398[FIPS-7398])
Templates are visible and editable in the Productdefinition view, therefore they can now also be navigated independently of the setting "Can navigate to model or Java Sourcecode".

image:{images-folder}navigate_template_en.png[width=598,height=254,align="center"]

==== Matcher (https://jira.faktorzehn.de/browse/FIPS-8175[FIPS-8175])
The matchers for the `org.faktorips.runtime.MessageList` in `de.faktorzehn.commons.ips.test.matcher.IpsMatchers` are now part of Faktor-IPS and available in `org.faktorips.testsupport.IpsMatchers` (some with a different name). 
Additionaly there are matchers for `org.faktorips.valueset.ValueSet` in `org.faktorips.testsupport.ValueSetMatchers`. +
Maven-Dependency:

[source, xml]
----
<dependency> 
    <groupId>org.faktorips</groupId> 
    <artifactId>org.faktorips.testsupport</artifactId> 
    <scope>test</scope>
</dependency>
----

==== Further Features and Improvements
* https://jira.faktorzehn.de/browse/FIPS-7448[FIPS-7448]: MultiEdit: promote to add-on status
* https://jira.faktorzehn.de/browse/FIPS-7549[FIPS-7549]: New extension point called before saving product components
* https://jira.faktorzehn.de/browse/FIPS-7761[FIPS-7761]: Documentation for relevances
* https://jira.faktorzehn.de/browse/FIPS-8196[FIPS-8196]: Product data in DB - FIPS Tables
* https://jira.faktorzehn.de/browse/FIPS-6359[FIPS-6359]: License for Runtime-Addon-JPA
* https://jira.faktorzehn.de/browse/FIPS-6836[FIPS-6836]: Error message relates to adaptor stage even if there is no adaptor stage
* https://jira.faktorzehn.de/browse/FIPS-6875[FIPS-6875]: Abstract Enums as datatype for policy-only attributes on concrete policy types
* https://jira.faktorzehn.de/browse/FIPS-7129[FIPS-7129]: Attribute "includes " should be displayed better
* https://jira.faktorzehn.de/browse/FIPS-7536[FIPS-7536]: Order of custom validations should match the one in the ExtensionPoint: org.faktorips.devtools.core.customValidation.
* https://jira.faktorzehn.de/browse/FIPS-7682[FIPS-7682]: Menu-Enablement should not unnecessarily instantiate IPS objects
* https://jira.faktorzehn.de/browse/FIPS-7816[FIPS-7816]: Use official Eclipse-Update-Site as Default in Mojo
* https://jira.faktorzehn.de/browse/FIPS-7921[FIPS-7921]: Switch tutorial to Maven projects
* https://jira.faktorzehn.de/browse/FIPS-7922[FIPS-7922]: Use -Dmaven.repo.local in Mojo's Eclipse
* https://jira.faktorzehn.de/browse/FIPS-7968[FIPS-7968]: Tests against different versions
* https://jira.faktorzehn.de/browse/FIPS-7980[FIPS-7980]: Method to check whether a ValueSet is limited
* https://jira.faktorzehn.de/browse/FIPS-7981[FIPS-7981]: Faktor-IPS Maven Plugin should work with Lombok in a project
* https://jira.faktorzehn.de/browse/FIPS-8168[FIPS-8168]: toString in PolicyCmptType subclasses should call super by default

=== Fixed Bugs
* https://jira.faktorzehn.de/browse/FIPS-1602[FIPS-1602]: NPE when trying to Copy&Paste in Attribute Edit Dialog
* https://jira.faktorzehn.de/browse/FIPS-6450[FIPS-6450]: Concrete Enum can't be switched to abstract
* https://jira.faktorzehn.de/browse/FIPS-6570[FIPS-6570]: Value Set can't be changed when creating a product attribute
* https://jira.faktorzehn.de/browse/FIPS-6683[FIPS-6683]: IPS-Test can't find Maven dependencies
* https://jira.faktorzehn.de/browse/FIPS-6701[FIPS-6701]: "Includes <null>" in product editor can't be removed when <null> is not allowed in the policy attribute
* https://jira.faktorzehn.de/browse/FIPS-7749[FIPS-7749]: Radio buttons for relevance stay readonly for templates
* https://jira.faktorzehn.de/browse/FIPS-7759[FIPS-7759]: Copy&Paste in dialogs
* https://jira.faktorzehn.de/browse/FIPS-7884[FIPS-7884]: NullPointerException when checking values of attributes in a LongRange
* https://jira.faktorzehn.de/browse/FIPS-7885[FIPS-7885]: IllegalArgumentException when checking an attribute value of type Money in ValueSet with differing currency
* https://jira.faktorzehn.de/browse/FIPS-7909[FIPS-7909]: ProductCmptBuilderr: cardinality missing in super call
* https://jira.faktorzehn.de/browse/FIPS-7969[FIPS-7969]: CSV import adding to table is not persisted
* https://jira.faktorzehn.de/browse/FIPS-7970[FIPS-7970]: Archetype does not work in Eclipse
* https://jira.faktorzehn.de/browse/FIPS-7971[FIPS-7971]: Empty line in generated Javadoc comment in Table Row classes
* https://jira.faktorzehn.de/browse/FIPS-7973[FIPS-7973]: NullPointerException in product structure explorer
* https://jira.faktorzehn.de/browse/FIPS-7979[FIPS-7979]: StringLengthValueSet: faulty implementation of isEmpty() and isDiscrete()
* https://jira.faktorzehn.de/browse/FIPS-8063[FIPS-8063]: "Show structure" missing in product definition perspective context menu
* https://jira.faktorzehn.de/browse/FIPS-8073[FIPS-8073]: Validation for duplicate kind-id-version-id-combination can't be disabled
* https://jira.faktorzehn.de/browse/FIPS-8081[FIPS-8081]: NPE when calling "getValues(true)" on a BigDecimalRange without a step (step = null)
* https://jira.faktorzehn.de/browse/FIPS-8083[FIPS-8083]: Values for DynamicEnumDatatype in TableContent can't be corrected/displayed
* https://jira.faktorzehn.de/browse/FIPS-8088[FIPS-8088]: Maven Build fails irregularly
* https://jira.faktorzehn.de/browse/FIPS-8114[FIPS-8114]: DefaultRange.isUnrestricted(true) does not treat empty range correctly
* https://jira.faktorzehn.de/browse/FIPS-8147[FIPS-8147]: Maven-Build hangs
* https://jira.faktorzehn.de/browse/FIPS-8149[FIPS-8149]: Java 11 breaks XMLs with values and extension properties
* https://jira.faktorzehn.de/browse/FIPS-8156[FIPS-8156]: NPE when fixing differences
* https://jira.faktorzehn.de/browse/FIPS-8198[FIPS-8198]: Product structure explorer does not display static rules
* https://jira.faktorzehn.de/browse/FIPS-8206[FIPS-8206]: Errors in tutorial
* https://jira.faktorzehn.de/browse/FIPS-8219[FIPS-8219]: No more handles in DeepCopyWizard
* https://jira.faktorzehn.de/browse/FIPS-8226[FIPS-8226]: Long attributes in FIPS enums create noncompilable code in enums
* https://jira.faktorzehn.de/browse/FIPS-8230[FIPS-8230]: Date-Picker in Eclipse 21.6

