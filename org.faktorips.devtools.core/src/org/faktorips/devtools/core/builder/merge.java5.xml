<?xml version="1.0" encoding="UTF-8"?>
<merge:options
  braceStyle="matching"  
  redirect="Gen"
  block="\s*@\s*generated\s*NOT\s*(?:\n\r?|\r\n?)"
  xmlns:merge="http://www.eclipse.org/org/eclipse/emf/codegen/jmerge/Options">

	<merge:dictionaryPattern name="generatedUnmodifiableMembers" select="Member/getComment" match="@\s*(gen)erated\s*(This field/method[^(?:\n\r?|\r\n?)]*)*(?:\n\r?|\r\n?)"/>
	<merge:dictionaryPattern name="generatedRestrainedModifableMember" select="Member/getComment" match="\s*@\s*(restrained)modifiable\s*\n"/>

	<merge:pull sourceGet="Member/getFlags" targetMarkup="^gen$" equals="Member/getName" targetPut="Member/setFlags"/>
	<merge:pull sourceGet="Type/getSuperInterfaces" sourceTransfer="(\s*@\s*extends|\s*@\s*implements)(.*?)(?:&lt;!--|(?:\n\r?|\r\n?))" targetMarkup="^gen$" targetPut="Type/addSuperInterface"/>
	<merge:pull sourceGet="Type/getSuperclass" targetMarkup="^gen$" targetPut="Type/setSuperclass"/>
	<merge:pull sourceGet="Method/getBody" targetMarkup="^gen$" targetPut="Method/setBody"/>    	
	<merge:pull sourceGet="Method/getReturnType" targetMarkup="^gen$" targetPut="Method/setReturnType"/>
	<merge:pull sourceGet="Method/getExceptions" targetMarkup="^gen$" targetPut="Method/addException"/>
	<merge:pull sourceGet="Field/getType" targetMarkup="^gen$" targetPut="Field/setType"/>
	<merge:pull sourceGet="Field/getInitializer" targetMarkup="^gen$" targetPut="Field/setInitializer"/>
	<merge:pull targetMarkup="^restrained$" sourceTransfer="(\s*//\s*begin-user-code.*?//\s*end-user-code\s*)\n" sourceGet="Method/getBody" targetPut="Method/setBody"/>
	<merge:pull sourceGet="Enum/getSuperInterfaces" sourceTransfer="(\s*@\s*extends|\s*@\s*implements)(.*?)(?:&lt;!--|(?:\n\r?|\r\n?))" targetMarkup="^gen$" targetPut="Enum/addSuperInterface"/>
	<merge:pull sourceGet="EnumConstant/getArguments" targetMarkup="^gen$" targetPut="EnumConstant/setArguments"/>
	<merge:pull sourceGet="EnumConstant/getBody" targetMarkup="^gen$" targetPut="EnumConstant/setBody"/>
	<!-- This is only for annotation type declarations - as far we do not generate our own annotations it is not realy needed -->
	<merge:pull sourceGet="AnnotationTypeMember/getType" targetMarkup="^gen$" targetPut="AnnotationTypeMember/setType"/>
    <merge:pull sourceGet="AnnotationTypeMember/getDefaultValue" targetMarkup="^gen$" targetPut="AnnotationTypeMember/setDefaultValue"/>

	<!-- These are the settings for merging annotations -->
	<!-- Defining the custom tag to keep custom annotations:
	does match any @generated or @restrainedmodifiable that is not followed by @customizedAnnotations -->
	<merge:dictionaryPattern name="customizedAnnotationsCONTENT" select="Member/getComment" match="@\s*(g(e)nerated|r(e)strainedmodifiable)(?![\s\S]*@\s*customizedAnnotations(.*(CONTENT\-CHANGED|ALL).*|\s*)(\n\r?|\r\n?))"/>
	<merge:dictionaryPattern name="customizedAnnotationsREMOVED" select="Member/getComment" match="@\s*(generate(d)|restraine(d)modifiable)(?![\s\S]*@\s*customizedAnnotations(.*(REMOVED|ALL).*|\s*)(\n\r?|\r\n?))"/>
	<merge:dictionaryPattern name="customizedAnnotationsADDED" select="Member/getComment" match="@\s*(gener(a)ted|restr(a)inedmodifiable)(?![\s\S]*@\s*customizedAnnotations(.*(ADDED|ALL).*|\s*)(\n\r?|\r\n?))"/>
	<!-- overwrite the content of annotations -->
	<merge:pull sourceGet="Annotation/getContents" targetParentMarkup="^e$" targetPut="Annotation/setContents"/>
	<!-- only write the annotation if the parent is maked as generated -->
	<merge:push targetParentMarkup="^d$" select="Annotation"/>
	<!-- Remove annotations of generated target nodes if the annotation is not in the source -->
	<merge:sweep parentMarkup="^a$" select="Annotation" />	

	<merge:sweep markup="^gen$" select="Member"/>
	
	<!--
	This would be the code to comment out not used restraintmodifiable - however we decided to let them in 
	<merge:sweep markup="^restrained$" action="comment" select="Member"/>
	 -->

	<!-- Overwrite the java doc comment before @generated or @restrainedmodifiable and use the customized java doc comment after @generated 
	<merge:pull targetMarkup="^gen$|^restrained$" sourceGet="Member/getComment" sourceTransfer="@\s*(?:generated|restrainedmodifiable)(.*\n)?(.*)?" targetPut="Member/setComment"/>
	-->
	<!-- Do not overwrite comment of type until we have a new merge strategy to check every java file that there is no @implements before the @generated tag  -->
	<merge:pull sourceGet="Method/getComment" targetMarkup="^gen$|^restrained$" sourceTransfer="@\s*(?:generated|restrainedmodifiable)(.*\n)?" targetPut="Method/setComment"/>
	<merge:pull sourceGet="Field/getComment" targetMarkup="^gen$|^restrained$" sourceTransfer="@\s*(?:generated|restrainedmodifiable)(.*\n)?" targetPut="Field/setComment"/>
	
</merge:options>

<!-- There is currently a problem when merging javadoc of members. The merging of javadoc of methods and field still works in
     the way that the javadoc of the target is overridden by the javadoc of the source as long as the target is marked 
     @generated. The merging of the javadoc of the type has been disabled for the moment because it conflicted with the
     functionality of adding additional interfaces to the type. Adding addtion interfaces to a type is accomplished by
     an @implements marker in the type javadoc section of the target. By means of the Type/getSuperInterfaces pull rule,
     see above, the part specified after @implements will be added to implements part of the class definition. 
     If there would be a rule in place that overrides the type javadoc also the @implements part would be overridden and
     therefore the mechanism of adding additional interfaces to the class definition wouldn't work.
     See faktorips.org flyspray entry No. where the fixing of this problem is addressed. 
	 The pull rules below are there to keep remembering the alternatives.	 
		<merge:pull sourceMarkup="^gen$" sourceGet="Type/getComment" sourceTransfer="(\s*begin-user-doc.*?end-user-doc\s*)(?:\n\r?|\r\n?)" targetMarkup="^gen$" targetPut="Type/setComment"/>
		<merge:pull targetMarkup="^gen$" sourceGet="Member/getComment" targetPut="Member/setComment"/>
-->


<!-- New addtional
<merge:pull sourceGet="Type/getTypeParameters" targetMarkup="^gen$" targetPut="Type/setTypeParameters"/>
  <merge:pull 
    sourceGet="Method/getTypeParameters"
    targetMarkup="^gen$"
    targetPut="Method/setTypeParameters"/>

<merge:pull sourceGet="Annotation/getContents" targetParentMarkup="^gen$" targetPut="Annotation/setContents"/>

-->

<!--

Documentation:
http://www.ibm.com/developerworks/library/os-ecemf3/

merge:push
	when the element is not in the source but not in the target, the element is pushed by default. By setting a merge:push rule
	you could limit the pushing for example to only push the element if the @generated tag exists. e.g. you want to push annotations
	only for elements that are marked with @generated. 

merge:sweep
	Removes members that are not generated

-->
